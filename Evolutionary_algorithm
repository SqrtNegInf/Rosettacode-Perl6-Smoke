#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Evolutionary_algorithm
#c# 2015-11-14 <RC, 2017-05-11 <RC
#m# MOAR: OK
#j#  JVM: OK

srand 123456;

# Works with: rakudo version 2015-11-11
constant target = "METHINKS IT IS LIKE A WEASEL";
constant mutate_chance = .08;
constant @alphabet = flat 'A'..'Z',' ';
constant C = 100;

sub mutate { [~] (rand < mutate_chance ?? @alphabet.pick !! $_ for $^string.comb) }
#sub mutate { $^string.subst(/./, { rand < mutate_chance ?? @alphabet.pick !! $/ }, :g) }
#sub mutate { $^string.comb.map({ rand < mutate_chance ?? @alphabet.pick !! $_ }).join }
sub fitness { [+] $^string.comb Zeq state @ = target.comb }

my @res;
loop (
    my $parent = @alphabet.roll(target.chars).join;
    $parent ne target;
    $parent = max :by(&fitness), mutate($parent) xx C
) { @res.push: sprintf "%6d: '%s'", $++, $parent }
.say for @res;

my $moar = qq:to/END/;
     0: 'SGRQOETRATVBH TGLFDKB ZKWYKZ'
     1: 'SGRQOWTRATVBH TGLFAKB ZKWSKZ'
     2: 'SGROOWTRATTBHZTOLKTKI ZKWSKY'
     3: 'SGROOWTRATTAHJTOLKTK  WKWSKY'
     4: 'SGROOWTRATTAHJTOLKFK  WKASKY'
     5: 'SGROOWTRATTAHJTLLKFK  WKASKY'
     6: 'SGROOWTR TTAHJTLLKFZ  WKASKT'
     7: 'SGROOWTR TTAHJTLLKFZ  WKASKD'
     8: 'SGRHOWTR TTAHJTLGKFZ  WKASKD'
     9: 'SGRHOWTS TTAHJTLGKFZ  WKASKD'
    10: 'SGRHOWTS TTAHJTLGKFZW WKASKD'
    11: 'SGRHONTS TTAPJTLGKFZW WKASKD'
    12: 'SGRHONTS TTXPJTLGKMZW WKASKD'
    13: 'SGRHONTS HTXPJTLIKMZW WKASKD'
    14: 'SORHONKS HTXPJTLIKMZW WKASKD'
    15: 'SVRHINKS HTXPJTLIKMZW WKASKD'
    16: 'SVTHINKS TTXPJTLIKMZW WKASKD'
    17: 'SVTHINKS TTXPJTLIKMZW WKASKD'
    18: 'SVTHINKS ITXPJTLIKMZJ WKASKD'
    19: 'SETHINKS ITQPJTLIKMZJ WKASKD'
    20: 'METHINKS ITNPJTLIKMZJ W ASKD'
    21: 'METHINKS ITKPJTLIKM J W ASKY'
    22: 'METHINKS ITKNJTLIKM A W ASCY'
    23: 'METHINKS ITKNJTLIKM A W ASCY'
    24: 'METQINKS ITKNJTLIKM A W ASCL'
    25: 'METQINKS ITKNJTLIKC A W ASCL'
    26: 'METQINKS ITKIJDLIKC A W ASCL'
    27: 'METQINKS ITKIJDLIKC A W ASCL'
    28: 'METQINKS ITKIJDLIKC A W ASCL'
    29: 'METHINKS ITKIJDLIKC A W AS L'
    30: 'METHINKS ITKIJDLIKC A W AS L'
    31: 'METHINKS ITKIRDLIKC A W AS L'
    32: 'METHINKS ITSIRDLIKC A W AS L'
    33: 'METHINKS ITSIRDLIKC A W AS L'
    34: 'METHINKS ITEIRDLIKC A WMAS L'
    35: 'METHINKS ITEIR LIKG A WRAS L'
    36: 'METHINKS ITEIR LIKG A WRAS L'
    37: 'METHINKS ITEIS LIKP A WRAS L'
    38: 'METHINKS ITEIS LIKP A WRAS L'
    39: 'METHINKS ITEIS LIKP A WEAS L'
    40: 'METHINKS ITEIS LIKP A WEAS L'
    41: 'METHINKS ITEIS LIKP A WEAS L'
    42: 'METHINKS ITEIS LIKP A WEAS L'
    43: 'METHINKS ITEIS LIKP A WEAS L'
    44: 'METHINKS ITEIS LIKP A WEAS L'
    45: 'METHINKS ITEIS LIKP A WEAS L'
    46: 'METHINKS ITEIS LIKP A WEAS L'
    47: 'METHINKS ITEIS LIKP A WEAS L'
    48: 'METHINKS ITCIS LIKP A WEAS L'
    49: 'METHINKS ITCIS LIKP A WEAS L'
    50: 'METHINKS ITCIS LIKP A WEAS L'
    51: 'METHINKS ITCIS LIKP A WEAS L'
    52: 'METHINKS ITCIS LIKP A WEASVL'
    53: 'METHINKS ITCIS LIKP A WEASVL'
    54: 'METHINKS ITCIS LIKP A WEASVL'
    55: 'METHINKS ITCIS LIKP A WEASVL'
    56: 'METHINKS ITCIS LIKP A WEASVL'
    57: 'METHINKS ITCIS LIKE A WEASVL'
    58: 'METHINKS ITCIS LIKE A WEASVL'
    59: 'METHINKS ITCIS LIKE A WEASVL'
    60: 'METHINKS ITCIS LIKE A WEASVL'
    61: 'METHINKS ITCIS LIKE A WEASVL'
    62: 'METHINKS ITCIS LIKE A WEASVL'
    63: 'METHINKS ITCIS LIKE A WEASEL'
    64: 'METHINKS ITCIS LIKE A WEASEL'
    65: 'METHINKS ITCIS LIKE A WEASEL'
    66: 'METHINKS ITCIS LIKE A WEASEL'
    67: 'METHINKS ITCIS LIKE A WEASEL'
    68: 'METHINKS ITCIS LIKE A WEASEL'
    69: 'METHINKS ITCIS LIKE A WEASEL'
    70: 'METHINKS ITCIS LIKE A WEASEL'
    71: 'METHINKS ITCIS LIKE A WEASEL'
    72: 'METHINKS ITLIS LIKE A WEASEL'
    73: 'METHINKS ITLIS LIKE A WEASEL'
END

my $jvm = qq:to/END/;
     0: 'L GTBOLOYSMDDQICEZRTQRWFEEAY'
     1: 'L GHBOLOYSTDDQICEZRYZRWFEEAY'
     2: 'L GHBNLONSTDDQICEZRYARWFEEAY'
     3: 'L GHBNLSNSTDDQICEZRYARWFEEAY'
     4: 'L GHBNLSKSTDDQ CEZRYARWDEYNY'
     5: 'L GHBNTSKST DQ CEZSPARWDEYIY'
     6: 'L CHBNES ST DQ CEZSPARWDEYIY'
     7: 'O CHBNES ST DQ CEZSPA WDEYSL'
     8: 'O CHBNZS ST DQ CEZSPA WDESSL'
     9: 'O CHBNZS ST DQ CEZPPA WEESSL'
    10: 'O CHBNZS ST DQ CEZPPA WEESSL'
    11: 'O CHBNZS ST DQ LEZ FA WEESSL'
    12: 'OEPHBNZS ST DQ LEZ FA WEESSL'
    13: 'OEPHINZS ST DQ LEZ FA WEESSL'
    14: 'OEPHINZS ST SS LEZ FA WEESSL'
    15: 'OEPHINZS ST SS LEZ FA WEESSL'
    16: 'OEPHINZS ST SS LEXEFA WEESSL'
    17: 'OEPHINZS ST SS LEXEFA WEESSL'
    18: 'OEPHINZS ST SS LIXEVA WETSSL'
    19: 'OEPHINKS ST SS LIIEVA WETSSL'
    20: 'OEPHINKS ST SS LIIEVA WETSSL'
    21: 'OEPHINKS ST SS LIIEZA WETSSL'
    22: 'PEPHINKS ST SS LISE A WETSSL'
    23: 'PEPHINKS ST SS LIWE A WETSSL'
    24: 'PEPHINKS ST SS LIWE A WEASSL'
    25: 'PETHINKS LT SS LIWE A WEASSL'
    26: 'PETHINKS LT SS LIWE A WEASSL'
    27: 'YETHINKS LT SS LIWE A WEASSL'
    28: 'YETHINKS LT SS LIWE A WEASSL'
    29: 'YETHINKS LT SS LIDE A WEASSL'
    30: 'YETHINKS LT SS LIDE A WEASSL'
    31: 'YETHINKS IT SS LIDE A WEASSL'
    32: 'YETHINKS IT SS LIDE A WEASSL'
    33: 'YETHINKS IT SS LIDE A WEASZL'
    34: 'YETHINKS IT SS LIDE A WEASZL'
    35: 'YETHINKS IT SS LIDE A WEASNL'
    36: 'YETHINKS IT SS LIDE A WEASNL'
    37: 'YETHINKS IT SS LIDE A WEASNL'
    38: 'YETHINKS IT SS LIDE A WEASNL'
    39: 'YETHINKS IT SS LIKE A WEASNL'
    40: 'YETHINKS IT SS LIKE A WEASNL'
    41: 'YETHINKS IT IS LIKE A WEASNL'
    42: 'YETHINKS IT IS LIKE A WEASNL'
    43: 'YETHINKS IT IS LIKE A WEASNL'
    44: 'YETHINKS IT IS LIKE A WEASEL'
    45: 'YETHINKS IT IS LIKE A WEASEL'
    46: 'GETHINKS IT IS LIKE A WEASEL'
    47: 'GETHINKS IT IS LIKE A WEASEL'
    48: 'GETHINKS IT IS LIKE A WEASEL'
END

use Test;
if $*VM ~~ /jvm/ {
is @res.join("\n"), chomp $jvm;
} else {
is @res.join("\n"), chomp $moar;
}
