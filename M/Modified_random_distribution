#!/usr/bin/env raku
#u# http://rosettacode.org/wiki/Modified_random_distribution
#c# 2021-02-28 <RC
#m# MOAR: OK
#j# JVM:  OK

srand 123456;

my @res;

sub modified_random_distribution ( Code $modifier --> Seq ) {
    return lazy gather loop {
        my ( $r1, $r2 ) = rand, rand;
        take $r1 if $modifier.($r1) > $r2;
    }
}
sub modifier ( Numeric $x --> Numeric ) {
    return 2 × ( $x < 1/2 ?? ( 1/2 - $x  )
                          !! ( $x  - 1/2 ) );
} 
sub print_histogram ( @data, :$n-bins, :$width ) { # Assumes minimum of zero.
    my %counts = bag @data.map: { floor( $_ × $n-bins ) / $n-bins };
    my $max_value = %counts.values.max;
    sub hist { '■' x ( $width × $^count / $max_value ) }
    #say ' Bin, Counts: Histogram';
    @res.push: sprintf "%4.2f, %6d: %s\n", .key, .value, hist(.value) for %counts.sort;
}

my @d = modified_random_distribution( &modifier );

print_histogram( @d.head(50_000), :n-bins(20), :width(64) );

my $moar-cronjob = q:to/END/;
0.00,   4790: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.05,   4297: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.10,   3805: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.15,   3272: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.20,   2791: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.25,   2217: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.30,   1729: ■■■■■■■■■■■■■■■■■■■■■■■
0.35,   1275: ■■■■■■■■■■■■■■■■■
0.40,    755: ■■■■■■■■■■
0.45,    254: ■■■
0.50,    244: ■■■
0.55,    747: ■■■■■■■■■
0.60,   1224: ■■■■■■■■■■■■■■■■
0.65,   1758: ■■■■■■■■■■■■■■■■■■■■■■■
0.70,   2175: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.75,   2771: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.80,   3317: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.85,   3632: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.90,   4191: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.95,   4756: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
END

my $moar-terminal = q:to/END/;
0.00,   4789: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.05,   4299: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.10,   3804: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.15,   3273: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.20,   2791: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.25,   2217: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.30,   1729: ■■■■■■■■■■■■■■■■■■■■■■■
0.35,   1275: ■■■■■■■■■■■■■■■■■
0.40,    755: ■■■■■■■■■■
0.45,    254: ■■■
0.50,    244: ■■■
0.55,    747: ■■■■■■■■■
0.60,   1224: ■■■■■■■■■■■■■■■■
0.65,   1757: ■■■■■■■■■■■■■■■■■■■■■■■
0.70,   2175: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.75,   2771: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.80,   3317: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.85,   3632: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.90,   4191: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.95,   4756: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
END

my $jvm = q:to/END/;
0.00,   4802: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.05,   4213: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.10,   3805: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.15,   3197: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.20,   2764: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.25,   2236: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.30,   1792: ■■■■■■■■■■■■■■■■■■■■■■■
0.35,   1263: ■■■■■■■■■■■■■■■■
0.40,    714: ■■■■■■■■■
0.45,    236: ■■■
0.50,    246: ■■■
0.55,    753: ■■■■■■■■■■
0.60,   1220: ■■■■■■■■■■■■■■■■
0.65,   1780: ■■■■■■■■■■■■■■■■■■■■■■■
0.70,   2260: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.75,   2819: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.80,   3347: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.85,   3672: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.90,   4237: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
0.95,   4644: ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
END

.print for @res;

use Test;
is @res.join(''), $*VM ~~ /jvm/ ?? $jvm !! $*IN.t ?? $moar-terminal !! $moar-cronjob;
