#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Metallic_ratios
#c# 2019-10-30 <RC
#m# MOAR: OK
#j# JVM:  OK

my @res;

use Rat::Precise;
use Lingua::EN::Numbers;

for <Platinum Golden Silver Bronze Copper Nickel Aluminum Iron Tin Lead>.kv
  -> \b, $name {
    @res.push: "\nLucas sequence for $name ratio; where b = {b}:\nFirst 15 elements: ";
    my $L = cache 1.FatRat, 1, * + b * * â€¦ *;
    @res[*-1] ~= join ', ', $L[^15];
    my $N = 0;
    my $last = 0;
    loop {
        my $approx = $L[$N +1] / $L[$N];
        my $this = $approx.precise(:z);
        last if $this eq $last;
        $last = $this;
        $N++;
    }
    @res.push: "Approximated value: $last - Reached after {$N} iterations: " ~
        "{ordinal-digit $N}/{ordinal-digit $N - 1} element. (zero indexed)";
}

.say for @res;

my $ref = q:to/END/;

Lucas sequence for Platinum ratio; where b = 0:
First 15 elements: 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
Approximated value: 1.0 - Reached after 1 iterations: 1st/0th element. (zero indexed)

Lucas sequence for Golden ratio; where b = 1:
First 15 elements: 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610
Approximated value: 1.61803398874989484820458683436564 - Reached after 78 iterations: 78th/77th element. (zero indexed)

Lucas sequence for Silver ratio; where b = 2:
First 15 elements: 1, 1, 3, 7, 17, 41, 99, 239, 577, 1393, 3363, 8119, 19601, 47321, 114243
Approximated value: 2.41421356237309504880168872420970 - Reached after 44 iterations: 44th/43rd element. (zero indexed)

Lucas sequence for Bronze ratio; where b = 3:
First 15 elements: 1, 1, 4, 13, 43, 142, 469, 1549, 5116, 16897, 55807, 184318, 608761, 2010601, 6640564
Approximated value: 3.30277563773199464655961063373525 - Reached after 34 iterations: 34th/33rd element. (zero indexed)

Lucas sequence for Copper ratio; where b = 4:
First 15 elements: 1, 1, 5, 21, 89, 377, 1597, 6765, 28657, 121393, 514229, 2178309, 9227465, 39088169, 165580141
Approximated value: 4.23606797749978969640917366873128 - Reached after 28 iterations: 28th/27th element. (zero indexed)

Lucas sequence for Nickel ratio; where b = 5:
First 15 elements: 1, 1, 6, 31, 161, 836, 4341, 22541, 117046, 607771, 3155901, 16387276, 85092281, 441848681, 2294335686
Approximated value: 5.19258240356725201562535524577016 - Reached after 25 iterations: 25th/24th element. (zero indexed)

Lucas sequence for Aluminum ratio; where b = 6:
First 15 elements: 1, 1, 7, 43, 265, 1633, 10063, 62011, 382129, 2354785, 14510839, 89419819, 551029753, 3395598337, 20924619775
Approximated value: 6.16227766016837933199889354443272 - Reached after 23 iterations: 23rd/22nd element. (zero indexed)

Lucas sequence for Iron ratio; where b = 7:
First 15 elements: 1, 1, 8, 57, 407, 2906, 20749, 148149, 1057792, 7552693, 53926643, 385039194, 2749201001, 19629446201, 140155324408
Approximated value: 7.14005494464025913554865124576352 - Reached after 22 iterations: 22nd/21st element. (zero indexed)

Lucas sequence for Tin ratio; where b = 8:
First 15 elements: 1, 1, 9, 73, 593, 4817, 39129, 317849, 2581921, 20973217, 170367657, 1383914473, 11241683441, 91317382001, 741780739449
Approximated value: 8.12310562561766054982140985597408 - Reached after 20 iterations: 20th/19th element. (zero indexed)

Lucas sequence for Lead ratio; where b = 9:
First 15 elements: 1, 1, 10, 91, 829, 7552, 68797, 626725, 5709322, 52010623, 473804929, 4316254984, 39320099785, 358197153049, 3263094477226
Approximated value: 9.10977222864644365500113714088140 - Reached after 20 iterations: 20th/19th element. (zero indexed)
END

use Test;
is @res.join("\n"), chomp $ref;
