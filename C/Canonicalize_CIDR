#!/usr/bin/env raku
#u# http://rosettacode.org/wiki/Canonicalize_CIDR
#c# 2020-07-09 <RC
#m# MOAR: OK
#j# JVM:  OK

# canonicalize a CIDR block: make sure none of the host bits are set
#if (!@*ARGS) {
#   @*ARGS = $*IN.lines;
#}
#

#for @*ARGS -> $cidr {

my $cidr = '87.70.141.1/22';

  # dotted-decimal / bits in network part
  my ($dotted, $size) = $cidr.split('/');

  # get IP as binary string
  my $binary = $dotted.split('.').map({ .fmt("%08b") }).join;

  # Replace the host part with all zeroes
  $binary.substr-rw($size) = 0 x (32 - $size);

  # Convert back to dotted-decimal
  my $canon = $binary.comb.batch(8).map({ .join.parse-base(2) }).join('.');

  # And output
  say my $result = "$canon/$size";
#}

my $ref = '87.70.140.0/22';

use Test;
is $result, $ref;
