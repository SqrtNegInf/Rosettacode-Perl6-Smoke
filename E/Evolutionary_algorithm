#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Evolutionary_algorithm
#c# 2015-11-14 <RC, 2017-05-11 <RC, 2019-06-25 <RC
#m# MOAR: OK
#j#  JVM: OK

srand 123456;

# Works with: rakudo version 2015-11-11
constant target = "METHINKS IT IS LIKE A WEASEL";
constant mutate_chance = .08;
constant @alphabet = flat 'A'..'Z',' ';
constant C = 100;

sub mutate { [~] (rand < mutate_chance ?? @alphabet.pick !! $_ for $^string.comb) }
#sub mutate { $^string.subst(/./, { rand < mutate_chance ?? @alphabet.pick !! $/ }, :g) }
#sub mutate { $^string.comb.map({ rand < mutate_chance ?? @alphabet.pick !! $_ }).join }
sub fitness { [+] $^string.comb Zeq @ = target.comb }

my @res;
loop (
    my $parent = @alphabet.roll(target.chars).join;
    $parent ne target;
    $parent = max :by(&fitness), mutate($parent) xx C
) { @res.push: sprintf "%6d: '%s'", $++, $parent }

#.say for @res; exit;

my $moar = qq:to/END/;
     0: 'FBQCPGHYCJEQTUBHAJRTXRLHRUDJ'
     1: 'FNQCPGHYCJEQTUBLAJRTXRLHRUDJ'
     2: 'FNQCPGHYCJEQ UBLAJRTARXMRUDJ'
     3: 'FNQCPGHYCJEQ UBLAJRTARWMRUDJ'
     4: 'FNQCPGHZCPSQ FBLAJR ARWMRUDJ'
     5: 'MNQCPGHZCPUQ FBLAJR ARWMRUEJ'
     6: 'MNQCPGHZCPUQ FBLAJR ARWMRSEJ'
     7: 'MNQCPGNZCPUQ FBLQJD A WMRSEJ'
     8: 'MNQCPGNZ PUQ SBLQJD A WMRSDJ'
     9: 'MNQCPGKV PZQ SBLNJD A WMRSDJ'
    10: 'MIGCPGKV PZQ S LN D A WMRSDJ'
    11: 'MIGCPGKV PWQ S LN D A WMRSDJ'
    12: 'MIGCPGKV PWQ S LN D A WMASDJ'
    13: 'MIGHPGKV PIQ S LN D A WJASDJ'
    14: 'MIGHPGKV PIQ S LN D A WJASDJ'
    15: 'MIGHPGKM PIQ S LN D A WJASDJ'
    16: 'MI HPGKS PIQ S LN D A WJASDJ'
    17: 'MI HPGKS PVQ S LN D A WJASIJ'
    18: 'MI HPGKS PVY S LN D A WJASIJ'
    19: 'MILHPGKS PVY S LFBD A WEASIJ'
    20: 'MILHIGKS PVY S LFBD A WEASIJ'
    21: 'MILHIGKS PNY S LFBD A WEASIJ'
    22: 'MILHIGKS INY S LFBD A WEASIJ'
    23: 'MILHIOKS INYBS LFBD A WEASIJ'
    24: 'MILHIAKS INYBS LFBD A WEASIJ'
    25: 'MELHIAKS INYBS LFBD A WEASBB'
    26: 'MEKHIAKS INYBS LIBD A WEASBB'
    27: 'MEKHIAKS IN BS LBBD A WEASBB'
    28: 'MEKHIAKS IN BS LBBD A WEASBB'
    29: 'MEKHIAKS IN BS LBBD A WEASBB'
    30: 'MEKHIAKS IN BS LIBD A WEASBB'
    31: 'MEKHIAKS IN RS LIBD A WEASBB'
    32: 'MEKHIAKS IN IS LIBD A WEASBB'
    33: 'MEKHIAKS IN IS LIBD A WEASBB'
    34: 'MEKHIAKS IN IS LIBD A WEASBB'
    35: 'MEKHIAKS IN IS LIBD A WEASBB'
    36: 'MEKHIAKS IN IS LIBD A WEASBB'
    37: 'MEKHIAKS IN IS LIBD A WEASBL'
    38: 'MEKHIAKS IN IS LIBD A WEASBL'
    39: 'MEKHIAKS IN IS LIBD A WEASBL'
    40: 'MEKHIAKS IN IS LIBY A WEASBL'
    41: 'MEKHIAKS IN IS LIBY A WEASBL'
    42: 'MEKHIAKS IN IS LIBY A WEASBL'
    43: 'MEKHIAKS IN IS LIBY A WEASBL'
    44: 'MEKHILKS IN IS LIBY A WEASBL'
    45: 'MEKHILKS IN IS LIBY A WEASBL'
    46: 'MEKHILKS IN IS LIBE A WEASBL'
    47: 'MEKHILKS IT IS LIBE A WEASBL'
    48: 'MEKHILKS IT IS LIJE A WEASBL'
    49: 'MEKHILKS IT IS LIJE A WEASBL'
    50: 'METHILKS IT IS LIJE A WEASBL'
    51: 'METHILKS IT IS LIJE A WEASBL'
    52: 'METHILKS IT IS LIJE A WEASBL'
    53: 'METHILKS IT IS LIJE A WEASBL'
    54: 'METHILKS IT IS LIJE A WEASBL'
    55: 'METHILKS IT IS LIJE A WEASBL'
    56: 'METHILKS IT IS LINE A WEASBL'
    57: 'METHILKS IT IS LINE A WEASBL'
    58: 'METHILKS IT IS LINE A WEASBL'
    59: 'METHILKS IT IS LINE A WEASBL'
    60: 'METHILKS IT IS LIEE A WEASKL'
    61: 'METHILKS IT IS LIEE A WEASKL'
    62: 'METHILKS IT IS LIEE A WEASKL'
    63: 'METHILKS IT IS LICE A WEASKL'
    64: 'METHILKS IT IS LICE A WEASKL'
    65: 'METHILKS IT IS LICE A WEASKL'
    66: 'METHILKS IT IS LICE A WEASKL'
    67: 'METHIJKS IT IS LICE A WEASKL'
    68: 'METHIJKS IT IS LICE A WEASQL'
    69: 'METHIJKS IT IS LICE A WEASQL'
    70: 'METHIJKS IT IS LICE A WEASQL'
    71: 'METHIJKS IT IS LICE A WEASQL'
    72: 'METHIJKS IT IS LICE A WEASQL'
    73: 'METHIJKS IT IS LICE A WEASQL'
    74: 'METHIJKS IT IS LICE A WEASQL'
    75: 'METHIJKS IT IS LICE A WEASQL'
    76: 'METHIJKS IT IS LICE A WEASQL'
    77: 'METHINKS IT IS LICE A WEASQL'
    78: 'METHINKS IT IS LICE A WEASQL'
    79: 'METHINKS IT IS LICE A WEASQL'
    80: 'METHINKS IT IS LICE A WEASQL'
    81: 'METHINKS IT IS LICE A WEASQL'
    82: 'METHINKS IT IS LICE A WEASQL'
    83: 'METHINKS IT IS LICE A WEASQL'
    84: 'METHINKS IT IS LICE A WEASQL'
    85: 'METHINKS IT IS LICE A WEASQL'
    86: 'METHINKS IT IS LICE A WEASQL'
    87: 'METHINKS IT IS LICE A WEASQL'
    88: 'METHINKS IT IS LIKE A WEASQL'
END

my $jvm = qq:to/END/;
     0: 'L GTBOLOYSMDDQICEZRTQRWFEEAY'
     1: 'L GHBOLOYSTDDQICEZRYZRWFEEAY'
     2: 'L GHBNLONSTDDQICEZRYARWFEEAY'
     3: 'L GHBNLSNSTDDQICEZRYARWFEEAY'
     4: 'L GHBNLSKSTDDQ CEZRYARWDEYNY'
     5: 'L GHBNTSKST DQ CEZSPARWDEYIY'
     6: 'L CHBNES ST DQ CEZSPARWDEYIY'
     7: 'O CHBNES ST DQ CEZSPA WDEYSL'
     8: 'O CHBNZS ST DQ CEZSPA WDESSL'
     9: 'O CHBNZS ST DQ CEZPPA WEESSL'
    10: 'O CHBNZS ST DQ CEZPPA WEESSL'
    11: 'O CHBNZS ST DQ LEZ FA WEESSL'
    12: 'OEPHBNZS ST DQ LEZ FA WEESSL'
    13: 'OEPHINZS ST DQ LEZ FA WEESSL'
    14: 'OEPHINZS ST SS LEZ FA WEESSL'
    15: 'OEPHINZS ST SS LEZ FA WEESSL'
    16: 'OEPHINZS ST SS LEXEFA WEESSL'
    17: 'OEPHINZS ST SS LEXEFA WEESSL'
    18: 'OEPHINZS ST SS LIXEVA WETSSL'
    19: 'OEPHINKS ST SS LIIEVA WETSSL'
    20: 'OEPHINKS ST SS LIIEVA WETSSL'
    21: 'OEPHINKS ST SS LIIEZA WETSSL'
    22: 'PEPHINKS ST SS LISE A WETSSL'
    23: 'PEPHINKS ST SS LIWE A WETSSL'
    24: 'PEPHINKS ST SS LIWE A WEASSL'
    25: 'PETHINKS LT SS LIWE A WEASSL'
    26: 'PETHINKS LT SS LIWE A WEASSL'
    27: 'YETHINKS LT SS LIWE A WEASSL'
    28: 'YETHINKS LT SS LIWE A WEASSL'
    29: 'YETHINKS LT SS LIDE A WEASSL'
    30: 'YETHINKS LT SS LIDE A WEASSL'
    31: 'YETHINKS IT SS LIDE A WEASSL'
    32: 'YETHINKS IT SS LIDE A WEASSL'
    33: 'YETHINKS IT SS LIDE A WEASZL'
    34: 'YETHINKS IT SS LIDE A WEASZL'
    35: 'YETHINKS IT SS LIDE A WEASNL'
    36: 'YETHINKS IT SS LIDE A WEASNL'
    37: 'YETHINKS IT SS LIDE A WEASNL'
    38: 'YETHINKS IT SS LIDE A WEASNL'
    39: 'YETHINKS IT SS LIKE A WEASNL'
    40: 'YETHINKS IT SS LIKE A WEASNL'
    41: 'YETHINKS IT IS LIKE A WEASNL'
    42: 'YETHINKS IT IS LIKE A WEASNL'
    43: 'YETHINKS IT IS LIKE A WEASNL'
    44: 'YETHINKS IT IS LIKE A WEASEL'
    45: 'YETHINKS IT IS LIKE A WEASEL'
    46: 'GETHINKS IT IS LIKE A WEASEL'
    47: 'GETHINKS IT IS LIKE A WEASEL'
    48: 'GETHINKS IT IS LIKE A WEASEL'
END

use Test;
if $*VM ~~ /jvm/ {
is @res.join("\n"), chomp $jvm;
} else {
is @res.join("\n"), chomp $moar;
}
