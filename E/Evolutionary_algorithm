#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Evolutionary_algorithm
#c# 2015-11-14 <RC, 2017-05-11 <RC, 2019-06-25 <RC
#m# MOAR: OK
#j#  JVM: OK

srand 123456;

# Works with: rakudo version 2015-11-11
constant target = "METHINKS IT IS LIKE A WEASEL";
constant mutate_chance = .08;
constant @alphabet = flat 'A'..'Z',' ';
constant C = 100;

sub mutate { [~] (rand < mutate_chance ?? @alphabet.pick !! $_ for $^string.comb) }
#sub mutate { $^string.subst(/./, { rand < mutate_chance ?? @alphabet.pick !! $/ }, :g) }
#sub mutate { $^string.comb.map({ rand < mutate_chance ?? @alphabet.pick !! $_ }).join }
sub fitness { [+] $^string.comb Zeq @ = target.comb }

my @res;
loop (
    my $parent = @alphabet.roll(target.chars).join;
    $parent ne target;
    $parent = max :by(&fitness), mutate($parent) xx C
) { @res.push: sprintf "%6d: '%s'", $++, $parent }
#.say for @res;

my $moar = qq:to/END/;
     0: 'OFBQCPGHYCJEQTUBHAJRTXRLHRUD'
     1: 'OFBQCPGHYEJEQTUBHAJATXREARUD'
     2: 'OEBQCPGHYEJEQTUBHAJAXXREARUD'
     3: 'OEBQCPKHYEJEQTUBHAJAXXREARUD'
     4: 'OEBQCPKH EJEQTUBHAJAXXREARUD'
     5: 'OETQCPKT EJEQTUBHAXAXXREARUD'
     6: 'OETQCPKS EJEQTUBHAXAXXREARUD'
     7: 'METQCPKS EJEQTUBHGXAXXREARUD'
     8: 'METQIPKS EJEQGWBHGXSXXREARUD'
     9: 'METQIPKS EJEQGWBHGXSXXREARUL'
    10: 'METOIPKS EJEQG OHGYSXXREARUL'
    11: 'METOIPKS EJEQG OHGWSXXREARUL'
    12: 'METDIPKS EJEQG OHKWSXXREARUL'
    13: 'METDIPKS EJ QG OHKDSXXREARUL'
    14: 'METDIPKS UJ QG OHKDSAXHEARUL'
    15: 'METDIPKS UJ QS OHKDSAXHEARUL'
    16: 'METDIPKS UJ QS OHKESAXHEARUL'
    17: 'METDIPKS UJ QS OYKESAXHEASUL'
    18: 'METDIPKS UJ QS OYKESAXHEASUL'
    19: 'METDIPKS UJ QS OYKESAXHEASUL'
    20: 'METDIPKS IJ QS OYKESAXHEASUL'
    21: 'METDINKS IJ QS OYKESAXHEASUL'
    22: 'METDINKS IA QS BYKESAXHEASUL'
    23: 'METDINKS IA QS BYKESAXHEASUL'
    24: 'METDINKS IT DS BYKESAXHEASUL'
    25: 'METDINKS IT DS BYKESAXOEASUL'
    26: 'METDINKS IT DS BYKESAXOEASUL'
    27: 'METDINKS IT JS BYKESAXOEASUL'
    28: 'METDINKS IT JS NYKESAVOEASUL'
    29: 'METDINKS IT JS NYKESAVOEASUL'
    30: 'METDINKS IT JSKNYKESAVOEASEL'
    31: 'METDINKS IT JSLNYKESAVOEASEL'
    32: 'METDINKS IT JSLNYKESAVOEASEL'
    33: 'METDINKS IT JSLNYKESAVOEASEL'
    34: 'METDINKS IT JSLNYKESAVOEASEL'
    35: 'METDINKS IT JSLNYKESA OEASEL'
    36: 'METEINKS IT HSL YKESA HEASEL'
    37: 'METEINKS IT HSL YKESA QEASEL'
    38: 'METEINKS IT HSL YKESA QEASEL'
    39: 'METEINKS IT HSL YKESA QEASEL'
    40: 'METEINKS IT HSL YKESA QEASEL'
    41: 'METEINKS IT HSL YKESA QEASEL'
    42: 'METEINKS IT HSL YKESA QEASEL'
    43: 'METEINKS IT HSL YKESA QEASEL'
    44: 'METEINKS IT HSL YKESA QEASEL'
    45: 'METEINKS IT HSL YKESA QEASEL'
    46: 'METEINKS IT HSL YKESA QEASEL'
    47: 'METHINKS IT HSL YKESA QEASEL'
    48: 'METHINKS IT HSL YKESA QEASEL'
    49: 'METHINKS IT HSL YKESA QEASEL'
    50: 'METHINKS IT HSH YKESA QEASEL'
    51: 'METHINKS IT HSH YKE A QEASEL'
    52: 'METHINKS IT HSH YKE A QEASEL'
    53: 'METHINKS IT HSH IKE A QEASEL'
    54: 'METHINKS IT HSH IKE A QEASEL'
    55: 'METHINKS IT HSH IKE A QEASEL'
    56: 'METHINKS IT HSH IKE A QEASEL'
    57: 'METHINKS IT HSH IKE A QEASEL'
    58: 'METHINKS IT HS  IKE A QEASEL'
    59: 'METHINKS IT HS AIKE A QEASEL'
    60: 'METHINKS IT HS AIKE A QEASEL'
    61: 'METHINKS IT HS AIKE A QEASEL'
    62: 'METHINKS IT HS AIKE A QEASEL'
    63: 'METHINKS IT HS AIKE A QEASEL'
    64: 'METHINKS IT HS AIKE A QEASEL'
    65: 'METHINKS IT HS AIKE A QEASEL'
    66: 'METHINKS IT HS AIKE A QEASEL'
    67: 'METHINKS IT HS AIKE A QEASEL'
    68: 'METHINKS IT HS AIKE A QEASEL'
    69: 'METHINKS IT HS AIKE A PEASEL'
    70: 'METHINKS IT HS AIKE A PEASEL'
    71: 'METHINKS IT HS AIKE A PEASEL'
    72: 'METHINKS IT HS AIKE A CEASEL'
    73: 'METHINKS IT HS AIKE A CEASEL'
    74: 'METHINKS IT HS AIKE A CEASEL'
    75: 'METHINKS IT HS AIKE A CEASEL'
    76: 'METHINKS IT HS AIKE A CEASEL'
    77: 'METHINKS IT HS AIKE A CEASEL'
    78: 'METHINKS IT QS AIKE A CEASEL'
    79: 'METHINKS IT QS AIKE A CEASEL'
    80: 'METHINKS IT QS AIKE A CEASEL'
    81: 'METHINKS IT QS AIKE A CEASEL'
    82: 'METHINKS IT MS AIKE A CEASEL'
    83: 'METHINKS IT MS AIK  A WEASEL'
    84: 'METHINKS IT MS AIK  A WEASEL'
    85: 'METHINKS IT MS AIK  A WEASEL'
    86: 'METHINKS IT MS LIK  A WEASEL'
    87: 'METHINKS IT MS LIK  A WEASEL'
    88: 'METHINKS IT MS LIK  A WEASEL'
    89: 'METHINKS IT MS LIK  A WEASEL'
    90: 'METHINKS IT MS LIK  A WEASEL'
    91: 'METHINKS IT MS LIK  A WEASEL'
    92: 'METHINKS IT MS LIKE A WEASEL'
    93: 'METHINKS IT HS LIKE A WEASEL'
    94: 'METHINKS IT HS LIKE A WEASEL'
    95: 'METHINKS IT HS LIKE A WEASEL'
    96: 'METHINKS IT HS LIKE A WEASEL'
    97: 'METHINKS IT HS LIKE A WEASEL'
    98: 'METHINKS IT HS LIKE A WEASEL'
    99: 'METHINKS IT HS LIKE A WEASEL'
   100: 'METHINKS IT HS LIKE A WEASEL'
   101: 'METHINKS IT HS LIKE A WEASEL'
END

my $jvm = qq:to/END/;
     0: 'L GTBOLOYSMDDQICEZRTQRWFEEAY'
     1: 'L GHBOLOYSTDDQICEZRYZRWFEEAY'
     2: 'L GHBNLONSTDDQICEZRYARWFEEAY'
     3: 'L GHBNLSNSTDDQICEZRYARWFEEAY'
     4: 'L GHBNLSKSTDDQ CEZRYARWDEYNY'
     5: 'L GHBNTSKST DQ CEZSPARWDEYIY'
     6: 'L CHBNES ST DQ CEZSPARWDEYIY'
     7: 'O CHBNES ST DQ CEZSPA WDEYSL'
     8: 'O CHBNZS ST DQ CEZSPA WDESSL'
     9: 'O CHBNZS ST DQ CEZPPA WEESSL'
    10: 'O CHBNZS ST DQ CEZPPA WEESSL'
    11: 'O CHBNZS ST DQ LEZ FA WEESSL'
    12: 'OEPHBNZS ST DQ LEZ FA WEESSL'
    13: 'OEPHINZS ST DQ LEZ FA WEESSL'
    14: 'OEPHINZS ST SS LEZ FA WEESSL'
    15: 'OEPHINZS ST SS LEZ FA WEESSL'
    16: 'OEPHINZS ST SS LEXEFA WEESSL'
    17: 'OEPHINZS ST SS LEXEFA WEESSL'
    18: 'OEPHINZS ST SS LIXEVA WETSSL'
    19: 'OEPHINKS ST SS LIIEVA WETSSL'
    20: 'OEPHINKS ST SS LIIEVA WETSSL'
    21: 'OEPHINKS ST SS LIIEZA WETSSL'
    22: 'PEPHINKS ST SS LISE A WETSSL'
    23: 'PEPHINKS ST SS LIWE A WETSSL'
    24: 'PEPHINKS ST SS LIWE A WEASSL'
    25: 'PETHINKS LT SS LIWE A WEASSL'
    26: 'PETHINKS LT SS LIWE A WEASSL'
    27: 'YETHINKS LT SS LIWE A WEASSL'
    28: 'YETHINKS LT SS LIWE A WEASSL'
    29: 'YETHINKS LT SS LIDE A WEASSL'
    30: 'YETHINKS LT SS LIDE A WEASSL'
    31: 'YETHINKS IT SS LIDE A WEASSL'
    32: 'YETHINKS IT SS LIDE A WEASSL'
    33: 'YETHINKS IT SS LIDE A WEASZL'
    34: 'YETHINKS IT SS LIDE A WEASZL'
    35: 'YETHINKS IT SS LIDE A WEASNL'
    36: 'YETHINKS IT SS LIDE A WEASNL'
    37: 'YETHINKS IT SS LIDE A WEASNL'
    38: 'YETHINKS IT SS LIDE A WEASNL'
    39: 'YETHINKS IT SS LIKE A WEASNL'
    40: 'YETHINKS IT SS LIKE A WEASNL'
    41: 'YETHINKS IT IS LIKE A WEASNL'
    42: 'YETHINKS IT IS LIKE A WEASNL'
    43: 'YETHINKS IT IS LIKE A WEASNL'
    44: 'YETHINKS IT IS LIKE A WEASEL'
    45: 'YETHINKS IT IS LIKE A WEASEL'
    46: 'GETHINKS IT IS LIKE A WEASEL'
    47: 'GETHINKS IT IS LIKE A WEASEL'
    48: 'GETHINKS IT IS LIKE A WEASEL'
END

use Test;
if $*VM ~~ /jvm/ {
is @res.join("\n"), chomp $jvm;
} else {
is @res.join("\n"), chomp $moar;
}
