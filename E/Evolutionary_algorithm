#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Evolutionary_algorithm
#c# 2015-11-14 <RC, 2017-05-11 <RC, 2019-06-25 <RC
#m# MOAR: OK
#j#  JVM: OK

srand 123456;

# Works with: rakudo version 2015-11-11
constant target = "METHINKS IT IS LIKE A WEASEL";
constant mutate_chance = .08;
constant @alphabet = flat 'A'..'Z',' ';
constant C = 100;

sub mutate { [~] (rand < mutate_chance ?? @alphabet.pick !! $_ for $^string.comb) }
#sub mutate { $^string.subst(/./, { rand < mutate_chance ?? @alphabet.pick !! $/ }, :g) }
#sub mutate { $^string.comb.map({ rand < mutate_chance ?? @alphabet.pick !! $_ }).join }
sub fitness { [+] $^string.comb Zeq @ = target.comb }

my @res;
loop (
    my $parent = @alphabet.roll(target.chars).join;
    $parent ne target;
    $parent = max :by(&fitness), mutate($parent) xx C
) { @res.push: sprintf "%6d: '%s'", $++, $parent }

#.say for @res; exit;

my $moar = qq:to/END/;
     0: 'UBHAJRTXRLHRUDJZYCJTNWSCDSHP'
     1: 'EOTGJRTXRLHRUDJZYCJTNWSCDSHP'
     2: 'EOTGJRTXRLHRUDJZYCETNWSCDSHP'
     3: 'EOTGJRTXRIHRUDJZYCETNWSCDSHP'
     4: 'EOTGJRTRRIHRUDJTYCETNWWCDSHP'
     5: 'EOTGJTTRRITRUDJTYCETNXWCDSHP'
     6: 'EOTGJNTRRITRUJJTYCETNXWCDSHP'
     7: 'ELTKJNTRRITRIJJTYCETNXWCDSHP'
     8: 'ELTKJNTRRITAIJJTYCETNXWCASHP'
     9: 'ELTKJNKRRITAIJHTYCETICWCASHP'
    10: 'ELTZRNKSRITAIJHTYCETICWCASHJ'
    11: 'ELTZRNKSRITAIJHLYCETIKWCASHJ'
    12: 'ELTZRNKSUITAIJHLYCETI WCASHJ'
    13: 'ELTZRNKS ITAIJHLYCETI W ASLJ'
    14: 'EYTZRNKS ITAIJHLYCE I W ASLJ'
    15: 'EYTZRNKS ITAIJHLYYE I W ASEJ'
    16: 'MYTZRNKS ITAIFHLYYE I W ASEJ'
    17: 'MYTZRNKS ITEISHLYYE I W ASEJ'
    18: 'MYTZRNKS ITEISHLWYE I W ASEJ'
    19: 'MYTZRNKS ITEISULWYE U W ASEJ'
    20: 'MYTZHNKS ITEISULWYE U W ASEJ'
    21: 'MYTZHNKS ITEISULWYE A W ASEJ'
    22: 'MYTZHNKS ITEISULWYE A W ASEJ'
    23: 'MZTZHNKS ITEIS LW E A W ASEJ'
    24: 'MZTUHNKS ITEIS LW E A W ASEJ'
    25: 'MZTHHNKS ITEIS LW E A W ASEJ'
    26: 'MZTHHNKS ITEIS LW E A W ASEJ'
    27: 'MZTHHNKS ITEIS LW E A WEASEJ'
    28: 'METHHNKS ITEIS LW E A WEASEJ'
    29: 'METHHNKS ITEIS LW E A WEASEJ'
    30: 'METHHNKS IT IS LW E A WEASEJ'
    31: 'METHHNKS IT IS LWWEAA WEASEL'
    32: 'METHCNKS IT IS LWWEAA WEASEL'
    33: 'METHCNKS IT IS LWWEAA WEASEL'
    34: 'METHCNKS IT IS LWWEAA WEASEL'
    35: 'METHCNKS IT IS LWWEAA WEASEL'
    36: 'METHCNKS IT IS LWKESA WEASEL'
    37: 'METHCNKS IT IS LWKESA WEASEL'
    38: 'METHCNKS IT IS LWKESA WEASEL'
    39: 'METHCNKS IT IS LWKEWA WEASEL'
    40: 'METHCNKS IT IS LWKEWA WEASEL'
    41: 'METHCNKS IT IS LWKEUA WEASEL'
    42: 'METHCNKS IT IS LWKEUA WEASEL'
    43: 'METHCNKS IT IS LWKE ATWEASEL'
    44: 'KETHCNKS IT IS LIKE ATWEASEL'
    45: 'KETHCNKS IT IS LIKE ATWEASEL'
    46: 'KETHCNKS IT IS LIKE ATWEASEL'
    47: 'KETHCNKS IT IS LIKE ATWEASEL'
    48: 'KETHCNKS IT IS LIKE ATWEASEL'
    49: 'KETHCNKS IT IS LIKE AAWEASEL'
    50: 'KETHCNKS IT IS LIKE AAWEASEL'
    51: 'KETHCNKS IT IS LIKE AAWEASEL'
    52: 'KETHCNKS IT IS LIKE AHWEASEL'
    53: 'KETH NKS IT IS LIKE AHWEASEL'
    54: 'KETH NKS IT IS LIKE AHWEASEL'
    55: 'KETH NKS IT IS LIKE AHWEASEL'
    56: 'KETH NKS IT IS LIKE AHWEASEL'
    57: 'KETH NKS IT IS LIKE AHWEASEL'
    58: 'GETH NKS IT IS LIKE AHWEASEL'
    59: 'GETH NKS IT IS LIKE AHWEASEL'
    60: 'GETH NKS IT IS LIKE AHWEASEL'
    61: 'GETH NKS IT IS LIKE AVWEASEL'
    62: 'GETH NKS IT IS LIKE AVWEASEL'
    63: 'GETH NKS IT IS LIKE AVWEASEL'
    64: 'GETH NKS IT IS LIKE AVWEASEL'
    65: 'METH NKS IT IS LIKE AVWEASEL'
    66: 'METH NKS IT IS LIKE AVWEASEL'
    67: 'METH NKS IT IS LIKE AVWEASEL'
    68: 'METH NKS IT IS LIKE AVWEASEL'
    69: 'METH NKS IT IS LIKE AVWEASEL'
    70: 'METHINKS IT IS LIKE AVWEASEL'
    71: 'METHINKS IT IS LIKE AVWEASEL'
    72: 'METHINKS IT IS LIKE AVWEASEL'
    73: 'METHINKS IT IS LIKE AIWEASEL'
    74: 'METHINKS IT IS LIKE AIWEASEL'
END

my $jvm = qq:to/END/;
     0: 'L GTBOLOYSMDDQICEZRTQRWFEEAY'
     1: 'L GHBOLOYSTDDQICEZRYZRWFEEAY'
     2: 'L GHBNLONSTDDQICEZRYARWFEEAY'
     3: 'L GHBNLSNSTDDQICEZRYARWFEEAY'
     4: 'L GHBNLSKSTDDQ CEZRYARWDEYNY'
     5: 'L GHBNTSKST DQ CEZSPARWDEYIY'
     6: 'L CHBNES ST DQ CEZSPARWDEYIY'
     7: 'O CHBNES ST DQ CEZSPA WDEYSL'
     8: 'O CHBNZS ST DQ CEZSPA WDESSL'
     9: 'O CHBNZS ST DQ CEZPPA WEESSL'
    10: 'O CHBNZS ST DQ CEZPPA WEESSL'
    11: 'O CHBNZS ST DQ LEZ FA WEESSL'
    12: 'OEPHBNZS ST DQ LEZ FA WEESSL'
    13: 'OEPHINZS ST DQ LEZ FA WEESSL'
    14: 'OEPHINZS ST SS LEZ FA WEESSL'
    15: 'OEPHINZS ST SS LEZ FA WEESSL'
    16: 'OEPHINZS ST SS LEXEFA WEESSL'
    17: 'OEPHINZS ST SS LEXEFA WEESSL'
    18: 'OEPHINZS ST SS LIXEVA WETSSL'
    19: 'OEPHINKS ST SS LIIEVA WETSSL'
    20: 'OEPHINKS ST SS LIIEVA WETSSL'
    21: 'OEPHINKS ST SS LIIEZA WETSSL'
    22: 'PEPHINKS ST SS LISE A WETSSL'
    23: 'PEPHINKS ST SS LIWE A WETSSL'
    24: 'PEPHINKS ST SS LIWE A WEASSL'
    25: 'PETHINKS LT SS LIWE A WEASSL'
    26: 'PETHINKS LT SS LIWE A WEASSL'
    27: 'YETHINKS LT SS LIWE A WEASSL'
    28: 'YETHINKS LT SS LIWE A WEASSL'
    29: 'YETHINKS LT SS LIDE A WEASSL'
    30: 'YETHINKS LT SS LIDE A WEASSL'
    31: 'YETHINKS IT SS LIDE A WEASSL'
    32: 'YETHINKS IT SS LIDE A WEASSL'
    33: 'YETHINKS IT SS LIDE A WEASZL'
    34: 'YETHINKS IT SS LIDE A WEASZL'
    35: 'YETHINKS IT SS LIDE A WEASNL'
    36: 'YETHINKS IT SS LIDE A WEASNL'
    37: 'YETHINKS IT SS LIDE A WEASNL'
    38: 'YETHINKS IT SS LIDE A WEASNL'
    39: 'YETHINKS IT SS LIKE A WEASNL'
    40: 'YETHINKS IT SS LIKE A WEASNL'
    41: 'YETHINKS IT IS LIKE A WEASNL'
    42: 'YETHINKS IT IS LIKE A WEASNL'
    43: 'YETHINKS IT IS LIKE A WEASNL'
    44: 'YETHINKS IT IS LIKE A WEASEL'
    45: 'YETHINKS IT IS LIKE A WEASEL'
    46: 'GETHINKS IT IS LIKE A WEASEL'
    47: 'GETHINKS IT IS LIKE A WEASEL'
    48: 'GETHINKS IT IS LIKE A WEASEL'
END

use Test;
if $*VM ~~ /jvm/ {
is @res.join("\n"), chomp $jvm;
} else {
is @res.join("\n"), chomp $moar;
}
