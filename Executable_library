#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Executable_library
#t# toodamnslow
#c# 2018-03-20 <RC, 2018-05-17 <RC, 2018-12-23 <RC
#m# MOAR: OK
#j# JVM:  OK
#n# uses module 'Hailstone.pm'
#n# what happened on 2018-12-20 ?? (and concurrency doesn't really help this bug...)

#`{{
#The library can be written as a module:

module Hailstone {
    our sub hailstone($n) is export {
	$n, { $_ %% 2 ?? $_ div 2 !! $_ * 3 + 1 } ... 1
    }
}
 
sub MAIN {
    say "hailstone(27) = {.[^4]} [...] {.[*-4 .. *-1]}" given Hailstone::hailstone 27;
}

#It can be run with:
$ perl6 Hailstone.pm

hailstone(27) = 27 82 41 124 [...] 8 4 2 1

#It can then be used with a program such as:
}}

use lib '.';
use Hailstone;
#my %score; %score{hailstone($_).elems}++ for 1 .. 1000;
(1 .. 1000).race.map: { %score{hailstone($_).elems}++ };
say my $result = "Most common length is {.key}, occurring {.value} times." given max :by(*.value), %score;

#Called with a command line as:

#$ PERL6LIB=. perl6 test-hailstone.p6
#The environment variable PERL6LIB might be necessary if the file Hailstone.pm is not in the standard library path for Perl 6.

use Test;
is $result, 'Most common length is 29, occurring 30 times.';
