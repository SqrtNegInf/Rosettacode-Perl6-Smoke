#!/usr/bin/env perl6
#n# NOT CURRENT, NOT SMOKE-TESTED
#u# http://rosettacode.org/wiki/Gamma_function
#c# 2015-11-22 <RC
#m# MOAR: OK
#j#  JVM: BROKEN
#n# after downgrade of Unicode name, another error, see bottom
#n# older error?  Type check failed in binding to nu; expected Int but got Num (1.0000000000000002e0)

sub Gamma(\z) {
    constant g = 9;
    z < .5 ?? pi/ sin(pi * z) / Gamma(1 - z) !!
    sqrt(2*pi) *
    (z + g - 1/2)**(z - 1/2) *
    exp(-(z + g - 1/2)) *
    [+] <
        1.000000000000000174663
     5716.400188274341379136
   -14815.30426768413909044
    14291.49277657478554025
    -6348.160217641458813289
     1301.608286058321874105
     -108.1767053514369634679
        2.605696505611755827729
       -0.7423452510201416151527e-2
        0.5384136432509564062961e-7
       -0.4023533141268236372067e-8
    > Z* 1, |map 1/(z + *), 0..*
}

say Gamma($_) for 1/3, 2/3 ... 10/3;

use Test;
is-approx Gamma(1/3), 2.67894, 'Γ(1/3)';
is Gamma(3), 2, 'Γ(9/3)';

#`{
current error:
perl6-j --ll-exception Gamma_function
Died
  in throw (gen/jvm/CORE.setting:34494)
  in <anon> (gen/jvm/CORE.setting:37000)
  in DIVIDE_NUMBERS (gen/jvm/CORE.setting:33288)
  in infix:<*> (gen/jvm/CORE.setting:33405)
  in infix:<*> (gen/jvm/CORE.setting:15474)
  in <anon> (gen/jvm/CORE.setting:57907)
  in pull-one (gen/jvm/CORE.setting:7926)
  in sum (gen/jvm/CORE.setting:2551)
  in sum (gen/jvm/CORE.setting:2619)
  in sum (gen/jvm/CORE.setting:2617)
  in Gamma (Gamma_function:10)
  in Gamma (Gamma_function:10)
  in <anon> (Gamma_function:29)
  in <unit> (Gamma_function:29)
  in <unit-outer> (Gamma_function:1)
  in eval (gen/jvm/stage2/NQPHLL.nqp:1168)
  in evalfiles (gen/jvm/stage2/NQPHLL.nqp:1390)
  in command_eval (gen/jvm/stage2/NQPHLL.nqp:1282)
  in command_eval (src/Perl6/Compiler.nqp:42)
  in command_line (gen/jvm/stage2/NQPHLL.nqp:1256)
  in MAIN (gen/jvm/main.nqp:47)
  in <mainline> (gen/jvm/main.nqp:38)
  in <anon> (gen/jvm/main.nqp)
}
