#!/usr/bin/env perl6
#u# http://rosettacode.org/wiki/Image_convolution
#c# 2019-10-13 <RC
#m# MOAR: BROKEN
#j# JVM:  BROKEN
#n# OS too old to 'zef install MagickWand', '_clock_gettime' missing

# https://github.com/azawawi/perl6-magickwand
# http://www.imagemagick.org/Usage/convolve/

#`{{

use v6;

use MagickWand;

# A new magic wand
my $original = MagickWand.new;

# Read an image
$original.read("./Lenna100.jpg") or die;

my $o = $original.clone;

# using coefficients from kernel "Sobel"
# http://www.imagemagick.org/Usage/convolve/#sobel
$o.convolve( [ 1, 0, -1,
               2, 0, -2,
               1, 0, -1] );

$o.write("Lenna100-convoluted.jpg") or die;

# And cleanup on exit
LEAVE {
  $original.cleanup   if $original.defined;
  $o.cleanup if $o.defined;
}


.say for @res;

my $ref = q:to/END/;
END

use Test;
#my $ref = $*VM ~~ /jvm/ ?? $jvm !! $moar;
#is @res.join("\n"), chomp $ref;

}}
